{% set count = Ev.itemsArr|length %}

{% if count == 0 and Ev.searchType != '' %}
    {{ "Sorry. I couldn't find anything :("|trans|msg('ko', false) }}
{% elseif count == 0 and Ev.searchType == '' %}
    {{ "Welcome to eLabFTW. Use the 'Create new' button to get started!"|trans|msg('ok', false) }}
{% else %}
    <p class='smallgray' style='display:inline'>
        {{ count }}
        {% trans %}
            result found
        {% plural count %}
            results found
        {% endtrans %}
        <a href='#' id='selectAllBoxes'>{{ 'Select all'|trans }}</a>
        <span id='advancedSelectOptions'> - <a href='#' id='unselectAllBoxes'>{{ 'Clear selection'|trans }}</a> - 
            <a href='#' id='invertSelection'>{{ 'Invert selection'|trans }}</a></span>
    </p>

    <p id='withSelected'>With selected:
    {% if not searchPage %}
        <select id='catChecked'>
            <option selected disabled>
            {% if Ev.Entity.type == 'experiments' %}
                {{ 'Change status'|trans }}
            {% else %}
                {{ 'Change item type'|trans }}
            {% endif %}
            </option>

            {% for category in Category.readAll() %}
                <option value='{{ category['category_id'] }}'>{{ category['category'] }}</option>
            {% endfor %}
        </select>
    {% endif %}
        <button data-what = 'zip' class='button csvzip'>{{ 'Make Zip'|trans }}</button>
        <button data-what='csv' class='button csvzip'>{{ 'Make Csv'|trans }}</button>
        <button id='deleteChecked' class='button button-delete'>{{ 'Delete'|trans }}</button>
    </p>
    <div class='row display-flex'>
    {% for item in Ev.itemsArr %}
        {% set permissions = Ev.Entity.getPermissions(item) %}
        {% if permissions.read %}
            {# dim the experiment a bit if it's not yours #}
            {% set opacity = '1' %}
            {% if (Ev.Entity.Users.userid != item.userid) and Ev.Entity.type == 'experiments' %}
                {% set opacity = '0.7' %}
            {% endif %}
            {% if Ev.Entity.Users.userData.single_column_layout %}
                <div class='col-xs-12 col-sm-12 col-md-12 col-lg-12'>
            {% else %}
                <div class='col-xs-12 col-sm-6 col-md-6 col-lg-4'>
            {% endif %}
            <section class='item' style='opacity:{{ opacity }}; border-left: 6px solid #{{ item.color }}'>

                <p class='title'>
                {% if item.locked %}
                    <img style='padding-bottom:3px;' src='app/img/lock-blue.png' alt='lock' />
                {% endif %}

                <a href='?mode=view&id={{ item.id }}'>{{ item.title|raw }}</a>
                </p>
                {% if item.next_step|length > 0 %}
                    {% set stepsArr = item.next_step|split('|') %}
                    {% set next = stepsArr|first %}
                    <p style='padding-left:20px'>
                    {{ 'Next step'|trans }}: <span style='color:black'>{{ next|raw }}</span>
                    </p>
                {% endif %}
<img id='bodyToggleImg_{{ item.id }}' data-type='{{ Ev.Entity.type }}' class='bodyToggleImg' src='app/img/show-more.png' title='Show more' alt='+' />
                <p style='padding-left:20px'>
                    <input type='checkbox' data-id='{{ item.id }}' data-type='{{ Ev.Entity.type }}' style='width:0%;vertical-align:-3px;' />
                {% if not item.locked %}
                <a href='?mode=edit&id={{ item.id }}'><img src='app/img/pen-blue.png' alt='edit' /></a>
                {% endif %}
                <span style='text-transform:uppercase;font-size:80%;color:#{{ item.color }}'>{{ item.category }}</span>
                <span class='date'><img class='image' src='app/img/calendar.png' />{{ item.date|kdate }}</span>
                {% if item.timestamped %}
                    <img src='app/img/stamp.png' alt='stamp' title='experiment timestamped' />
                {% endif %}

                {# show attached if there is a file attached #}
                {% if item.has_attachment %}
                    <img src='app/img/attached.png' alt='file attached' />
                {% endif %}

                {% if Ev.Entity.type == 'items' %}
                    {{ Ev.showStars(item.rating)|raw }}
                {% endif %}

                {% if item.tags is not null %}
                <span class='tags'><img src='app/img/tags.png' alt='tags' />
                    {% set tagsArr = item.tags|split('|') %}
                    {% for tag in tagsArr %}
                        <a href='?mode=show&tag={{ tag|url_encode }}'>{{ tag|raw }}</a>
                    {% endfor %}
                {% endif %}
                </p>
                <div class='bodyToggle' id='bodyToggle_{{ item.id }}' style='display:none; margin: 10px 0 0 20px'></div>
            </section>
            </div>
        {% endif %}
    {% endfor %}
    </div>

    {% if count > Ev.limit %}
        {# show load more button if there are more results than the default display number #}
        <div class='center'>
            <button class='button' id='loadButton'>{{ 'Show %s more'|trans|format(Ev.limit) }}</button>
            <button class='button button-neutral' id='loadAllButton'>{{ 'Show all'|trans }}</button>
        </div>
    {% endif %}

{% endif %}

<div id='shortcuts' data-create='{{ Ev.Entity.Users.userData.sc_create }}'></div>
<div id='limit' data-limit='{{ Ev.limit }}'></div>
<script src='app/js/show.min.js'></script>
